# å¯åŠ¨æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å¯åŠ¨å’Œä½¿ç”¨GNNä¸‰ç»´åœ°è´¨å»ºæ¨¡ç³»ç»Ÿã€‚

---

## ç›®å½•

1. [ç¯å¢ƒå‡†å¤‡](#1-ç¯å¢ƒå‡†å¤‡)
2. [æ•°æ®å‡†å¤‡](#2-æ•°æ®å‡†å¤‡)
3. [å‘½ä»¤è¡Œä½¿ç”¨](#3-å‘½ä»¤è¡Œä½¿ç”¨)
4. [å¯è§†åŒ–ç•Œé¢](#4-å¯è§†åŒ–ç•Œé¢)
5. [å¸¸è§é—®é¢˜](#5-å¸¸è§é—®é¢˜)

---

## 1. ç¯å¢ƒå‡†å¤‡

### 1.1 åˆ›å»ºCondaç¯å¢ƒ

```bash
# åˆ›å»ºåä¸º geomodel çš„è™šæ‹Ÿç¯å¢ƒ
conda create -n geomodel python=3.10 -y

# æ¿€æ´»ç¯å¢ƒ
conda activate geomodel
```

### 1.2 å®‰è£…PyTorch

æ ¹æ®ä½ çš„CUDAç‰ˆæœ¬é€‰æ‹©å®‰è£…å‘½ä»¤ï¼š

```bash
# CUDA 11.8
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

# CUDA 12.1
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121

# ä»…CPUï¼ˆæ— GPUï¼‰
pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cpu
```

### 1.3 å®‰è£…PyTorch Geometric

```bash
pip install torch-geometric
```

### 1.4 å®‰è£…å…¶ä»–ä¾èµ–

```bash
pip install -r requirements.txt
```

### 1.5 éªŒè¯å®‰è£…

```bash
python -c "import torch; print('PyTorch:', torch.__version__)"
python -c "import torch_geometric; print('PyG:', torch_geometric.__version__)"
python -c "from src.gnn_thickness_modeling import GNNThicknessPredictor; print('æ¨¡å—å¯¼å…¥æˆåŠŸ!')"
```

---

## 2. æ•°æ®å‡†å¤‡

### 2.1 æ•°æ®ç›®å½•ç»“æ„

å°†é’»å­”æ•°æ®æ”¾å…¥ `data/` ç›®å½•ï¼š

```
data/
â”œâ”€â”€ é’»å­”åæ ‡.csv          # åæ ‡æ–‡ä»¶ï¼ˆå¿…éœ€ï¼Œæ–‡ä»¶ååŒ…å«"åæ ‡"ï¼‰
â”œâ”€â”€ ZK001.csv            # é’»å­”1æ•°æ®
â”œâ”€â”€ ZK002.csv            # é’»å­”2æ•°æ®
â”œâ”€â”€ ZK003.csv            # é’»å­”3æ•°æ®
â””â”€â”€ ...                  # æ›´å¤šé’»å­”
```

### 2.2 åæ ‡æ–‡ä»¶æ ¼å¼

æ–‡ä»¶åå¿…é¡»åŒ…å«"åæ ‡"äºŒå­—ï¼ˆå¦‚ `é’»å­”åæ ‡.csv`ï¼‰ï¼š

```csv
é’»å­”å,åæ ‡x,åæ ‡y
ZK001,39645876.2,4438976.5
ZK002,39646120.8,4439102.3
ZK003,39645500.0,4439000.0
```

### 2.3 é’»å­”æ•°æ®æ–‡ä»¶æ ¼å¼

æ¯ä¸ªé’»å­”ä¸€ä¸ªCSVæ–‡ä»¶ï¼Œæ–‡ä»¶åå³é’»å­”åï¼ˆå¦‚ `ZK001.csv`ï¼‰ï¼š

```csv
åºå·,åç§°,åšåº¦/m,å¼¹æ€§æ¨¡é‡/GPa,å®¹é‡/kNÂ·m-3,æŠ—æ‹‰å¼ºåº¦/MPa
1,è…æ®–åœŸ,2.5,,,
2,ç ‚å²©,5.2,15.3,25.6,3.8
3,æ³¥å²©,3.1,8.4,23.2,1.2
4,ç…¤,1.8,3.5,14.0,0.5
5,ç ‚å²©,4.5,16.2,25.8,4.0
```

**å¿…éœ€åˆ—**ï¼š
- `åç§°` æˆ– `å²©æ€§`ï¼šå²©å±‚åç§°
- `åšåº¦/m` æˆ– `åšåº¦`ï¼šå²©å±‚åšåº¦

**å¯é€‰åˆ—**ï¼š
- `åºå·`ï¼šå±‚åºå·
- `å¼¹æ€§æ¨¡é‡`ã€`å®¹é‡`ã€`æŠ—æ‹‰å¼ºåº¦`ï¼šå²©å±‚å±æ€§

---

## 3. å‘½ä»¤è¡Œä½¿ç”¨

### 3.1 æŸ¥çœ‹å¸®åŠ©

```bash
python main_thickness.py --help
python main_thickness.py train --help
python main_thickness.py all --help
```

### 3.2 å®Œæ•´æµç¨‹ï¼ˆæ¨èï¼‰

ä¸€é”®å®Œæˆè®­ç»ƒå’Œå»ºæ¨¡ï¼š

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate geomodel

# è¿è¡Œå®Œæ•´æµç¨‹
python main_thickness.py all --epochs 300 --resolution 50
```

### 3.3 åˆ†æ­¥æ‰§è¡Œ

**æ­¥éª¤1ï¼šä»…è®­ç»ƒæ¨¡å‹**

```bash
python main_thickness.py train --epochs 300 --output output
```

å‚æ•°è¯´æ˜ï¼š
- `--epochs 300`ï¼šè®­ç»ƒ300è½®
- `--lr 0.001`ï¼šå­¦ä¹ ç‡
- `--hidden-dim 128`ï¼šéšè—å±‚ç»´åº¦
- `--gnn-layers 3`ï¼šGNNå±‚æ•°
- `--conv-type gatv2`ï¼šå·ç§¯ç±»å‹ï¼ˆgatv2/transformer/sageï¼‰
- `--patience 30`ï¼šæ—©åœè€å¿ƒå€¼

**æ­¥éª¤2ï¼šæ„å»ºä¸‰ç»´æ¨¡å‹**

```bash
python main_thickness.py build --model-path output/best_model.pt --resolution 50
```

å‚æ•°è¯´æ˜ï¼š
- `--model-path`ï¼šè®­ç»ƒå¥½çš„æ¨¡å‹è·¯å¾„
- `--resolution 50`ï¼šç½‘æ ¼åˆ†è¾¨ç‡ï¼ˆ50x50ï¼‰
- `--base-level 0.0`ï¼šåŸºå‡†é¢é«˜ç¨‹
- `--gap 0.0`ï¼šå±‚é—´é—´éš™

### 3.4 ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”

è¿è¡Œä¼ ç»Ÿæ’å€¼æ–¹æ³•ä½œä¸ºåŸºå‡†å¯¹æ¯”ï¼š

```bash
# çº¿æ€§æ’å€¼
python main_thickness.py baseline --method linear

# ä¸‰æ¬¡æ’å€¼
python main_thickness.py baseline --method cubic

# RBFæ’å€¼
python main_thickness.py baseline --method rbf
```

### 3.5 è¾“å‡ºç»“æœ

è¿è¡Œå®Œæˆåï¼ŒæŸ¥çœ‹ `output/` ç›®å½•ï¼š

```
output/
â”œâ”€â”€ best_model.pt              # æ¨¡å‹æƒé‡
â”œâ”€â”€ training_metadata.json     # è®­ç»ƒé…ç½®
â”œâ”€â”€ model_info.json            # æ¨¡å‹ä¿¡æ¯
â”œâ”€â”€ evaluation_report.txt      # è¯„ä¼°æŠ¥å‘Š
â”œâ”€â”€ layer_è…æ®–åœŸ.npz           # å„å±‚ç½‘æ ¼æ•°æ®
â”œâ”€â”€ layer_ç ‚å²©.npz
â”œâ”€â”€ layer_æ³¥å²©.npz
â””â”€â”€ layer_ç…¤.npz
```

---

## 4. å¯è§†åŒ–ç•Œé¢

### 4.1 å¯åŠ¨Streamlitåº”ç”¨

```bash
# æ¿€æ´»ç¯å¢ƒ
conda activate geomodel

# å¯åŠ¨Webç•Œé¢
streamlit run app.py
```

### 4.2 è®¿é—®ç•Œé¢

å¯åŠ¨åï¼Œåœ¨æµè§ˆå™¨æ‰“å¼€ï¼š
- æœ¬åœ°è®¿é—®ï¼šhttp://localhost:8501
- å±€åŸŸç½‘è®¿é—®ï¼šhttp://<ä½ çš„IP>:8501

### 4.3 ç•Œé¢åŠŸèƒ½

| æ ‡ç­¾é¡µ | åŠŸèƒ½ |
|--------|------|
| ğŸ“Š æ•°æ®æ¢ç´¢ | åŠ è½½æ•°æ®ã€æŸ¥çœ‹é’»å­”åˆ†å¸ƒã€å²©æ€§ç»Ÿè®¡ |
| ğŸš€ æ¨¡å‹è®­ç»ƒ | é…ç½®å‚æ•°ã€è®­ç»ƒGNNæ¨¡å‹ |
| ğŸ“ˆ ç»“æœåˆ†æ | æŸ¥çœ‹è®­ç»ƒæ›²çº¿ã€è¯„ä¼°æŒ‡æ ‡ |
| ğŸ—ºï¸ ä¸‰ç»´å¯è§†åŒ– | äº¤äº’å¼ä¸‰ç»´åœ°è´¨æ¨¡å‹ |
| ğŸ—ï¸ åœ°è´¨å»ºæ¨¡ | æ„å»ºå’Œå¯¼å‡ºæ¨¡å‹ |
| ğŸ“„ è®ºæ–‡é…å›¾ | ç”ŸæˆSCIè®ºæ–‡è´¨é‡çš„å›¾è¡¨ |

### 4.4 æŒ‡å®šç«¯å£å¯åŠ¨

```bash
# ä½¿ç”¨æŒ‡å®šç«¯å£
streamlit run app.py --server.port 8080

# å…è®¸å¤–éƒ¨è®¿é—®
streamlit run app.py --server.address 0.0.0.0
```

---

## 5. å¸¸è§é—®é¢˜

### Q1: CUDAå†…å­˜ä¸è¶³

**ç°è±¡**ï¼š`CUDA out of memory`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# å‡å°batch sizeæˆ–éšè—å±‚ç»´åº¦
python main_thickness.py train --hidden-dim 64 --epochs 200

# æˆ–ä½¿ç”¨CPU
python main_thickness.py train --device cpu
```

### Q2: æ‰¾ä¸åˆ°åæ ‡æ–‡ä»¶

**ç°è±¡**ï¼š`FileNotFoundError: æœªæ‰¾åˆ°åæ ‡æ–‡ä»¶`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿åæ ‡æ–‡ä»¶ååŒ…å«"åæ ‡"äºŒå­—
- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦åœ¨ `data/` ç›®å½•ä¸‹

### Q3: ç¼–ç é”™è¯¯

**ç°è±¡**ï¼š`UnicodeDecodeError`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å°†CSVæ–‡ä»¶å¦å­˜ä¸º UTF-8 ç¼–ç 
- æˆ–ä½¿ç”¨ GBK ç¼–ç ä¿å­˜

### Q4: æ¨¡å—å¯¼å…¥å¤±è´¥

**ç°è±¡**ï¼š`ModuleNotFoundError`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
cd D:\xiangmu\dizhijianmo

# ç¡®ä¿æ¿€æ´»äº†æ­£ç¡®çš„ç¯å¢ƒ
conda activate geomodel
```

### Q5: è®­ç»ƒä¸æ”¶æ•›

**ç°è±¡**ï¼šæŸå¤±ä¸ä¸‹é™æˆ–æ³¢åŠ¨å¤§

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# é™ä½å­¦ä¹ ç‡
python main_thickness.py train --lr 0.0005

# å¢åŠ è®­ç»ƒè½®æ•°
python main_thickness.py train --epochs 500 --patience 50
```

---

## å¿«é€Ÿå¯åŠ¨å‘½ä»¤æ±‡æ€»

```bash
# 1. æ¿€æ´»ç¯å¢ƒ
conda activate geomodel

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd D:\xiangmu\dizhijianmo

# 3. è¿è¡Œå®Œæ•´æµç¨‹
python main_thickness.py all --epochs 300

# 4. å¯åŠ¨å¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰
streamlit run app.py
```

---

## è”ç³»ä¸æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¯å¢ƒä¾èµ–æ˜¯å¦å®Œæ•´
3. æŸ¥çœ‹ `output/` ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
